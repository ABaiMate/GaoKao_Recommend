import{d as B,B as P,r as b,f as L,g as n,o as g,h as x,i,j as e,t as $,I as F,D as H,k as K,m as S,b as v,F as h,s as Q,p as R,a as j,l as M,q as N}from"./index-d31968a7.js";import{U as E}from"./UserAvatar-c28f9a89.js";import{u as z}from"./useNotify-cedc1ad3.js";import{u as A,a as D}from"./useRequest-4cb19bee.js";import{U as T}from"./UserCommentApi-5c7fae53.js";import{Q as O}from"./QueryPagination-33101695.js";import{u as G}from"./useLoginInfo-0c571403.js";import{u as J}from"./usePage-8ca7a06e.js";const W=B({__name:"CommentContent",props:{targetType:{},targetId:{},loginInfo:{},item:{}},emits:["submit"],setup(I,{emit:o}){const m=I,d=o,r=z(),c=P(),f=A();D();let p=b({content:""});L(()=>{});async function l(t,a){await f.run(T.create({...p.value,targetType:m.targetType,targetId:m.targetId,parentId:t,content:a})),r.success("发布成功"),p.value.content="",d("submit")}function u(t){c.dialog({title:"提示",message:"确认删除?",cancel:!0,persistent:!0}).onOk(async()=>{await f.run(T.deleteById(t.id)),r.success("删除成功"),d("submit")})}return(t,a)=>{const q=n("q-item-section"),_=n("q-item-label"),k=n("q-editor"),V=n("q-popup-edit"),C=n("q-btn"),U=n("q-item");return g(),x(U,{class:"comment-content",style:{"border-left":"1px solid #e0e0e0"}},{default:i(()=>[e(q,{avatar:""},{default:i(()=>[e(E,{"login-info":t.item.user},null,8,["login-info"])]),_:1}),e(q,null,{default:i(()=>{var s;return[e(_,{lines:"1",textContent:$((s=t.item.user)==null?void 0:s.nickname)},null,8,["textContent"]),e(_,{caption:"",innerHTML:t.item.content},null,8,["innerHTML"])]}),_:1}),e(q,{side:"",top:""},{default:i(()=>[e(_,{caption:"",textContent:$(t.item.createTime)},null,8,["textContent"]),e(C,{icon:"feedback",color:"grey",size:"sm",label:"回复",flat:"",dense:""},{default:i(()=>[e(V,{buttons:"",modelValue:p.value.content,"onUpdate:modelValue":a[1]||(a[1]=s=>p.value.content=s),"label-set":"回复",onSave:a[2]||(a[2]=s=>l(t.item.id,s))},{default:i(s=>[e(k,{modelValue:s.value,"onUpdate:modelValue":w=>s.value=w,"min-height":"5rem",autofocus:"",onKeyup:a[0]||(a[0]=F(H(()=>{},["stop"]),["enter"]))},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["modelValue"])]),_:1}),t.loginInfo.id===t.item.userId?(g(),x(C,{key:0,icon:"close",color:"grey",size:"sm",flat:"",dense:"",label:"删除",onClick:a[3]||(a[3]=s=>u(t.item))})):K("",!0)]),_:1})]),_:1})}}});const X=S(W,[["__scopeId","data-v-61f8c887"]]),Y={class:"comment-node",style:{"padding-left":"20px"}},Z=B({__name:"CommentNode",props:{targetType:{},targetId:{},loginInfo:{},item:{}},emits:["submit"],setup(I,{emit:o}){const m=I,d=o;return L(()=>{}),(r,c)=>{const f=n("q-separator"),p=n("CommentNode",!0);return g(),v("div",Y,[e(X,{targetType:m.targetType,targetId:m.targetId,loginInfo:r.loginInfo,item:r.item,onSubmit:c[0]||(c[0]=l=>d("submit"))},null,8,["targetType","targetId","loginInfo","item"]),e(f,{inset:"item"}),(g(!0),v(h,null,Q(r.item.children,l=>(g(),x(p,{key:l.id,targetType:m.targetType,targetId:m.targetId,loginInfo:r.loginInfo,item:l,onSubmit:c[1]||(c[1]=u=>d("submit"))},null,8,["targetType","targetId","loginInfo","item"]))),128))])}}});const ee=S(Z,[["__scopeId","data-v-fd677bdf"]]),te={class:"user-comment"},ne={class:"text-right q-mt-sm"},oe=["textContent"],ae=B({__name:"UserComment",props:{targetType:{},targetId:{}},setup(I){const o=I,m=z();P();const d=A(),r=D(),{toPage:c}=J(),f=G(!0),p=R(f,"loginInfo");let l=b({content:""});b({});let u=b({});j(()=>o.targetId,()=>{t()}),L(()=>{t()});async function t(){!o.targetType||!o.targetId||(r.start(),u.value=await d.run(T.getPage({...c(u.value),targetType:o.targetType,targetId:o.targetId})).finally(r.close))}async function a(){await d.run(T.create({...l.value,targetType:o.targetType,targetId:o.targetId})),m.success("发布成功"),l.value.content="",await t()}return(q,_)=>{const k=n("q-editor"),V=n("q-btn"),C=n("q-item-label"),U=n("q-list"),s=n("q-card-section"),w=n("q-card");return g(),v("div",te,[e(k,{modelValue:l.value.content,"onUpdate:modelValue":_[0]||(_[0]=y=>l.value.content=y)},null,8,["modelValue"]),M("div",ne,[e(V,{unelevated:"",color:"orange",onClick:a,disable:!l.value.content},{default:i(()=>[N("发表评论")]),_:1},8,["disable"])]),e(w,{class:"no-shadow q-mt-md"},{default:i(()=>[e(s,null,{default:i(()=>[e(U,null,{default:i(()=>[e(C,{header:""},{default:i(()=>[N("最新评论("),M("span",{textContent:$(u.value.total)},null,8,oe),N(")")]),_:1}),(g(!0),v(h,null,Q(u.value.list??[],y=>(g(),v("div",{key:y.id},[e(ee,{targetType:o.targetType,targetId:o.targetId,loginInfo:p.value,item:y,onSubmit:t},null,8,["targetType","targetId","loginInfo","item"])]))),128))]),_:1})]),_:1})]),_:1}),e(O,{class:"q-my-xl",page:u.value,"onUpdate:page":_[1]||(_[1]=y=>u.value=y),onChange:t,"no-search":""},null,8,["page"])])}}});const pe=S(ae,[["__scopeId","data-v-3361d236"]]);export{pe as U};
