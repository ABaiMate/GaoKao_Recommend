import{u as h,D as P}from"./useDialog-abda8b4e.js";import{L as N}from"./LoginApi-1dda4bc2.js";import{B as O}from"./BaseDialog-82865103.js";import{u as $,F as q,a as A}from"./useValid-d1447d9b.js";import{u as B,a as E}from"./useRequest-4cb19bee.js";import{u as H}from"./useNotify-cedc1ad3.js";import{U as x}from"./UserApi-7044f7f4.js";import{U as z}from"./UserAvatar-c28f9a89.js";import{U as M}from"./UploadUserAvatar-5e232abe.js";import{d as F,r as V,f as R,g as m,o as f,h as g,i as a,j as o,l as L,q as I,x as T,y as j,m as S,z as J,p as K,J as G,K as D}from"./index-d31968a7.js";import{F as C}from"./FormInputPassword-77e6c8e9.js";import{u as Q}from"./useLoginInfo-0c571403.js";const W=r=>(T("data-v-05ed6aa5"),r=r(),j(),r),X={class:"text-center q-mb-lg"},Y=W(()=>L("br",null,null,-1)),Z=F({__name:"UserInfoDialog",props:{type:{}},setup(r){const w=r,d=B(),v=$(),y=H(),u=E();let s=h(M,{persistent:!1}),t=V({}),p=V({});R(async()=>{await U(),await c()});async function U(){u.start(),p.value=await d.run(N.getLogin()).finally(u.close)}async function c(){u.start(),t.value=await d.run(x.getById(p.value.id)).finally(u.close)}function i(){s.show(P.NONE).onOk(e=>t.value.avatarFileId=e)}async function _(e){await v.submit(),e.start(),await d.run(x.modify(p.value.id,t.value)).finally(e.close),await c(),y.success("修改成功，重新登录后生效"),e.submit(t.value)}return(e,n)=>{const b=m("q-btn"),k=m("q-form");return f(),g(O,{class:"user-info-dialog",title:"用户信息",type:w.type,onSubmit:_},{default:a(()=>[o(k,{ref:"formRef",class:"form"},{default:a(()=>[L("div",X,[o(z,{"login-info":t.value},null,8,["login-info"]),Y,o(b,{class:"q-mt-sm",color:"primary",size:"xs",flat:"",onClick:n[0]||(n[0]=l=>i())},{default:a(()=>[I("更换头像")]),_:1})]),o(q,null,{default:a(()=>[o(A,{modelValue:t.value.username,"onUpdate:modelValue":n[1]||(n[1]=l=>t.value.username=l),label:"用户名",rules:[l=>l&&l.length>0||"请输入用户名"],disable:""},null,8,["modelValue","rules"]),o(A,{modelValue:t.value.nickname,"onUpdate:modelValue":n[2]||(n[2]=l=>t.value.nickname=l),label:"昵称",rules:[l=>l&&l.length>0||"请输入昵称"]},null,8,["modelValue","rules"])]),_:1})]),_:1},512),L("template",null,[o(M,{modelValue:e.showUpload,"onUpdate:modelValue":n[3]||(n[3]=l=>e.showUpload=l),onUploaded:e.onUploadSuccess},null,8,["modelValue","onUploaded"])])]),_:1},8,["type"])}}});const ee=S(Z,[["__scopeId","data-v-05ed6aa5"]]),oe=F({__name:"ChangePasswordDialog",props:{type:{}},setup(r){const w=r,d=B(),v=$(),y=H(),u=E();let s=V({}),t=V();R(async()=>{await p()});async function p(){u.start(),t.value=await d.run(N.getLogin()).finally(u.close)}async function U(c){await v.submit(),c.start(),await d.run(x.changePassword(s.value)).finally(c.close),y.success("修改成功"),c.submit(s.value)}return(c,i)=>{const _=m("q-form");return f(),g(O,{class:"password-dialog",title:"密码",type:w.type,onSubmit:U,width:"30%"},{default:a(()=>[o(_,{ref:"formRef",class:"form"},{default:a(()=>[o(q,null,{default:a(()=>[o(C,{modelValue:s.value.oldPassword,"onUpdate:modelValue":i[0]||(i[0]=e=>s.value.oldPassword=e),label:"原密码",rules:[e=>e&&e.length>0||"请输入原密码"]},null,8,["modelValue","rules"])]),_:1}),o(q,null,{default:a(()=>[o(C,{modelValue:s.value.newPassword,"onUpdate:modelValue":i[1]||(i[1]=e=>s.value.newPassword=e),label:"新密码",rules:[e=>e&&e.length>0||"请输入新密码"]},null,8,["modelValue","rules"])]),_:1}),o(q,null,{default:a(()=>[o(C,{modelValue:s.value.newPassword2,"onUpdate:modelValue":i[2]||(i[2]=e=>s.value.newPassword2=e),label:"再次输入新密码",rules:[e=>e&&e.length>0||"请输入新密码"]},null,8,["modelValue","rules"])]),_:1})]),_:1},512)]),_:1},8,["type"])}}});const ae=S(oe,[["__scopeId","data-v-be29cd79"]]),le=F({__name:"UserHeaderMenu",setup(r){const w=B(),d=J();let v=Q(),y=K(v,"clearLoginInfo"),u=h(ee),s=h(ae);R(()=>{});async function t(){u.show(P.NONE)}async function p(){s.show(P.NONE)}async function U(){await w.run(N.logout()),y.value(),await d.push("/login")}return(c,i)=>{const _=m("q-item-label"),e=m("q-item-section"),n=m("q-item"),b=m("q-list"),k=m("q-menu"),l=G("close-popup");return f(),g(k,null,{default:a(()=>[o(b,{separator:""},{default:a(()=>[D((f(),g(n,{clickable:"",onClick:t},{default:a(()=>[o(e,null,{default:a(()=>[o(_,null,{default:a(()=>[I("用户信息修改")]),_:1})]),_:1})]),_:1})),[[l]]),D((f(),g(n,{clickable:"",onClick:p},{default:a(()=>[o(e,null,{default:a(()=>[o(_,null,{default:a(()=>[I("密码修改")]),_:1})]),_:1})]),_:1})),[[l]]),D((f(),g(n,{clickable:"",onClick:U},{default:a(()=>[o(e,null,{default:a(()=>[o(_,null,{default:a(()=>[I("退出登录")]),_:1})]),_:1})]),_:1})),[[l]])]),_:1})]),_:1})}}});const ge=S(le,[["__scopeId","data-v-525c3bc8"]]);export{ge as U};
