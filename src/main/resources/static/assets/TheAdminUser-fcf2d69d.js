import{Q as L}from"./QueryContainer-778ca57d.js";import{Q as j}from"./QuerySearchCard-abfe6caa.js";import{Q as S}from"./QueryInput-b0beacee.js";import{Q as G}from"./QueryPagination-33101695.js";import{T as H}from"./TableContainer-6b49de73.js";import{F as J,Q as K}from"./FormSelect-62b36c15.js";import{U as C}from"./UserApi-7044f7f4.js";import{u as W,F as w,a as I}from"./useValid-d1447d9b.js";import{U as A}from"./UserAvatar-c28f9a89.js";import{U as X}from"./UploadUserAvatar-5e232abe.js";import{B as Y}from"./BaseDialog-82865103.js";import{u as B,D as y,a as Z}from"./useDialog-abda8b4e.js";import{u as F,a as ee}from"./useRequest-4cb19bee.js";import{u as N}from"./useNotify-cedc1ad3.js";import{u as te}from"./useFormRules-cbf82972.js";import{d as O,r as V,f as $,g as Q,o as U,h as le,i as r,j as t,l as n,q as oe,u as m,x as R,y as E,m as z,B as ae,b as T,F as se,s as ne,t as x}from"./index-d31968a7.js";import{T as ue}from"./TableToolbar-630e4f38.js";import{u as re}from"./usePage-8ca7a06e.js";import"./avatar-dc521f05.js";var D=(o=>(o.COMMON="普通用户",o.ADMIN="管理员",o))(D||{});function M(o){const i=[];for(let[c,b]of Object.entries(o))i.push({label:b,value:c});return i}const ie=o=>(R("data-v-a430b60f"),o=o(),E(),o),de={class:"text-center q-mb-lg"},me=ie(()=>n("br",null,null,-1)),pe=O({__name:"UserDialog",props:{type:{},id:{}},setup(o){const i=o,c=F(),b=W(),h=N(),{formRules:p}=te();let k=B(X,{persistent:!1}),e=V({});$(()=>{y.EDIT===i.type&&d()});async function d(){e.value=await c.run(C.getById(i.id))}function _(){k.show(y.NONE).onOk(f=>e.value.avatarFileId=f)}async function q(f){await b.submit(),f.start();let a;switch(i.type){case y.ADD:a=C.create(e.value);break;case y.EDIT:a=C.modify(i.id,e.value);break;default:return}await c.run(a).finally(f.close),h.success("保存成功"),f.submit(e.value)}return(f,a)=>{const v=Q("q-btn"),s=Q("q-form");return U(),le(Y,{class:"user-dialog",title:"用户",type:i.type,width:"35%",onSubmit:q,persistent:"","no-drag":""},{default:r(()=>[t(s,{ref:"formRef",class:"form q-col-gutter-y-md"},{default:r(()=>[n("div",de,[t(A,{"login-info":e.value},null,8,["login-info"]),me,t(v,{class:"q-mt-sm",color:"primary",size:"xs",flat:"",onClick:a[0]||(a[0]=u=>_())},{default:r(()=>[oe("更换头像")]),_:1})]),t(w,null,{default:r(()=>[t(I,{modelValue:e.value.username,"onUpdate:modelValue":a[1]||(a[1]=u=>e.value.username=u),label:"用户名",rules:m(p)},null,8,["modelValue","rules"]),t(I,{modelValue:e.value.nickname,"onUpdate:modelValue":a[2]||(a[2]=u=>e.value.nickname=u),label:"昵称",rules:m(p)},null,8,["modelValue","rules"])]),_:1}),t(w,null,{default:r(()=>[t(I,{modelValue:e.value.password,"onUpdate:modelValue":a[3]||(a[3]=u=>e.value.password=u),label:"密码",type:"password",rules:m(p)},null,8,["modelValue","rules"])]),_:1}),t(w,null,{default:r(()=>[t(J,{modelValue:e.value.roleCode,"onUpdate:modelValue":a[4]||(a[4]=u=>e.value.roleCode=u),label:"角色",rules:m(p),options:m(M)(m(D))},null,8,["modelValue","rules","options"])]),_:1})]),_:1},512)]),_:1},8,["type"])}}});const fe=z(pe,[["__scopeId","data-v-a430b60f"]]),g=o=>(R("data-v-f0c1b0f5"),o=o(),E(),o),ce={class:"admin-user"},_e=g(()=>n("th",{class:"text-left"},"头像",-1)),ve=g(()=>n("th",{class:"text-left"},"用户名",-1)),ye=g(()=>n("th",{class:"text-left"},"昵称",-1)),ge=g(()=>n("th",{class:"text-left"},"角色",-1)),be=g(()=>n("th",{class:"text-left"},"创建时间",-1)),Ce=g(()=>n("th",{class:"text-left"},"操作",-1)),ke=["textContent"],xe=["textContent"],Ve=["textContent"],Ue=["textContent"],De={class:"q-gutter-x-sm"},he=O({__name:"TheAdminUser",setup(o){const i=N();ae();const c=F();ee();const{toPage:b}=re(),{showDeleteDialog:h}=Z();let p=V(),k=B(fe),e=V({}),d=V({});$(()=>{});async function _(){p.value.loading.start(),d.value=await c.run(C.getPage({...e.value,...b(d.value)})).finally(p.value.loading.close)}function q(){k.show(y.ADD).onOk(_)}function f(v){k.show(y.EDIT,{id:v.id}).onOk(_)}async function a(v){await h()&&(await c.run(C.deleteById(v.id)),i.success("删除成功"),await _())}return(v,s)=>{const u=Q("q-btn");return U(),T("div",ce,[t(L,{query:e.value,"onUpdate:query":s[4]||(s[4]=l=>e.value=l),page:d.value,"onUpdate:page":s[5]||(s[5]=l=>d.value=l),onSearch:_},{default:r(()=>[t(j,{ref_key:"querySearchRef",ref:p},{default:r(()=>[t(S,{modelValue:e.value.username,"onUpdate:modelValue":s[0]||(s[0]=l=>e.value.username=l),label:"用户名"},null,8,["modelValue"]),t(S,{modelValue:e.value.nickname,"onUpdate:modelValue":s[1]||(s[1]=l=>e.value.nickname=l),label:"昵称"},null,8,["modelValue"]),t(K,{modelValue:e.value.roleCode,"onUpdate:modelValue":s[2]||(s[2]=l=>e.value.roleCode=l),label:"角色",options:m(M)(m(D))},null,8,["modelValue","options"])]),_:1},512),t(ue,null,{default:r(()=>[t(u,{label:"新增用户",icon:"add",flat:"",onClick:q})]),_:1}),t(H,null,{header:r(()=>[_e,ve,ye,ge,be,Ce]),body:r(()=>[(U(!0),T(se,null,ne(d.value.list??[],l=>(U(),T("tr",{key:l.id},[n("td",null,[t(A,{"login-info":l,size:"20px"},null,8,["login-info"])]),n("td",{textContent:x(l.username)},null,8,ke),n("td",{textContent:x(l.nickname)},null,8,xe),n("td",{textContent:x(m(D)[l.roleCode])},null,8,Ve),n("td",{textContent:x(l.createTime)},null,8,Ue),n("td",De,[t(u,{icon:"edit",label:"编辑",color:"blue",size:"sm",flat:"",dense:"",onClick:P=>f(l)},null,8,["onClick"]),t(u,{icon:"close",label:"删除",color:"orange",size:"sm",flat:"",dense:"",onClick:P=>a(l)},null,8,["onClick"])])]))),128))]),_:1}),t(G,{page:d.value,"onUpdate:page":s[3]||(s[3]=l=>d.value=l)},null,8,["page"])]),_:1},8,["query","page"])])}}});const Ge=z(he,[["__scopeId","data-v-f0c1b0f5"]]);export{Ge as default};
